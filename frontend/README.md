# Articles Frontend

Angular 21 SPA for the Elearnio coding challenge. Displays articles, comments, and engagement stats with a signal-driven architecture.

## Stack

| Component      | Choice                           |
|---------------|----------------------------------|
| Framework     | Angular 21.2 (standalone only)   |
| Language      | TypeScript 5.9 (strict mode)     |
| Styling       | Tailwind CSS v4 + Typography     |
| Testing       | Vitest + AnalogJS                |
| Markdown      | marked v17                       |
| Build         | esbuild via `@angular/build`     |

## Prerequisites

- Node 22+
- npm 11+
- Backend API running on `http://localhost:3000` (proxied in dev)

## Setup

```sh
npm install
npm start         # dev server on http://localhost:4200
```

The dev server proxies `/api` requests to `http://localhost:3000` via `proxy.conf.json`.

## Project Structure

```
src/app/
├── pages/                  # Smart (container) components
│   ├── article-list/       # Lists articles, handles creation
│   └── article-detail/     # Shows article, deferred comments
├── components/             # Dumb (presentational) components
│   ├── article-card/       # Article summary card
│   ├── article-form/       # Reactive form for new articles
│   ├── comment-form/       # Reactive form for new comments
│   └── comment-list/       # Renders comment list
├── services/
│   ├── article.service.ts  # Articles + comments HTTP calls
│   ├── engagement.service.ts  # Engagement stats with shareReplay
│   └── server-errors.ts    # Maps server errors to form controls
├── pipes/
│   └── markdown.pipe.ts    # marked-based markdown rendering
└── types/                  # Auto-generated from Rails serializers
    ├── Article.ts
    ├── ArticleDetail.ts
    ├── Comment.ts
    └── Engagement.ts
```

## Routes

| Path             | Component          | Loading   |
|------------------|--------------------|-----------|
| `/articles`      | ArticleListPage    | Lazy      |
| `/articles/:id`  | ArticleDetailPage  | Lazy      |
| `/`              | Redirects to `/articles` |    |
| `**`             | Redirects to `/articles` |    |

Route params are bound directly to component signal inputs via `withComponentInputBinding()`.

## Architecture

### Smart / Dumb Separation

- **Pages** (smart): inject services, hold state signals, handle HTTP subscriptions
- **Components** (dumb): communicate only via `input()` / `output()`, no injected services

### State Management

Signals + RxJS interop, no third-party store:

- `signal()` for component state and refresh triggers
- `computed()` for derived state
- `toSignal()` / `toObservable()` to bridge signals and HTTP observables
- `shareReplay(1)` on engagement stats for multi-subscriber efficiency

### Deferred Loading

- **Engagement panel**: `@defer (on idle)` — loads after main content is interactive
- **Comments section**: `@defer (on viewport)` — loads when scrolled into view

### Optimistic UI

New comments are prepended to a local signal immediately on successful POST, without re-fetching the comments list.

### Markdown

Article bodies are rendered via a `MarkdownPipe` using `marked`, displayed inside a Tailwind Typography `.prose` container.

## Type Sharing

TypeScript interfaces in `src/app/types/` are auto-generated by Typelizer from Rails Alba serializers. These are the single source of truth for API response shapes — do not edit manually.

## Styling

- Tailwind CSS v4 with `@tailwindcss/typography` plugin
- Palette: teal/emerald primary, gray neutrals, red errors
- Light mode only, no dark theme
- Skeleton loading states via `animate-pulse` placeholders
- All components use `ChangeDetectionStrategy.OnPush`

## Testing

```sh
npm test            # single run (CI)
npm run test:watch  # watch mode
```

Uses Vitest with `@analogjs/vitest-angular` (not Karma). Tests include:

- Service specs with `HttpTestingController`
- Component specs with signal inputs via `componentRef.setInput()`
- Pure unit tests for pipes and utilities

## Scripts

| Command            | Description                  |
|--------------------|------------------------------|
| `npm start`        | Dev server (port 4200)       |
| `npm run build`    | Production build to `dist/`  |
| `npm test`         | Run tests (Vitest)           |
| `npm run test:watch` | Tests in watch mode        |

## Deployment

Deployed to Fly.io (`elearnio-articles`, `ams` region).

- 2-stage Dockerfile: Node build → nginx serve
- nginx serves static assets with immutable cache headers
- `index.html` served with `no-cache` (SPA shell must always be fresh)
- `/api/` proxied to backend via Fly.io private network DNS
- `/health` endpoint for Fly.io health checks
- Security headers: `X-Content-Type-Options`, `X-Frame-Options`, `Referrer-Policy`

## Future Considerations

- Dark mode / theme switching
- Server-side rendering (SSR) or pre-rendering
- E2E testing (Playwright/Cypress)
- Content sanitization for markdown rendering
- Pagination for article lists
- Real-time comment updates (WebSocket)
- PWA / offline support
