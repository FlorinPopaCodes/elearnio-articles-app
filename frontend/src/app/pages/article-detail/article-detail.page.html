<div class="mx-auto max-w-3xl">
  <a routerLink="/articles" class="mb-4 inline-flex items-center rounded text-sm text-teal-600 transition hover:text-teal-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-teal-500 focus-visible:ring-offset-2">
    &larr; Back to articles
  </a>

  @if (article(); as article) {
    <article class="rounded-lg border border-gray-200 bg-white p-6">
      <h1 class="text-3xl font-bold text-gray-900">{{ article.title }}</h1>
      <div class="mt-2 flex items-center gap-3 text-sm text-gray-500">
        <span>{{ article.author_name }}</span>
        <span>&middot;</span>
        <time [attr.datetime]="article.created_at">{{ article.created_at | date:'mediumDate' }}</time>
        <span>&middot;</span>
        <span>{{ article.comments_count }} {{ article.comments_count === 1 ? 'comment' : 'comments' }}</span>
      </div>
      <div class="prose mt-6 max-w-none" [innerHTML]="article.body | markdown"></div>
    </article>

    @defer (on viewport) {
      <section class="mt-8">
        <h2 class="mb-4 text-xl font-semibold text-gray-900">Comments</h2>

        <div class="mb-6 rounded-lg border border-gray-200 bg-white p-6">
          <h3 class="mb-4 text-base font-semibold text-gray-900">Add a comment</h3>
          <app-comment-form
            [serverErrors]="commentErrors()"
            [submitting]="commentSubmitting()"
            (submitted)="onCommentSubmit($event)" />
        </div>

        <app-comment-list [comments]="comments()" />
      </section>
    } @placeholder {
      <div class="mt-8 h-32 animate-pulse rounded-lg bg-gray-100" aria-hidden="true"></div>
    } @loading {
      <div class="mt-8 text-center text-gray-400">Loading comments...</div>
    }
  } @else {
    <div class="flex items-center justify-center py-12" role="status" aria-label="Loading article">
      <div class="h-8 w-8 animate-spin rounded-full border-4 border-teal-600 border-t-transparent" aria-hidden="true"></div>
      <span class="sr-only">Loading article...</span>
    </div>
  }
</div>
